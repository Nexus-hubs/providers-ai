<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Solar System">
    <title>Interactive Solar System iPhone</title>
    <style>
        /* Mobile-Optimized CSS for iPhone */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #1a1f2e;
            --bg-tertiary: #252b3d;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-glow: #a78bfa;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: rgba(148, 163, 184, 0.2);
            --shadow-dark: rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f1419 50%, #1a0f2e 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            height: -webkit-fill-available;
            position: fixed;
            width: 100%;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a0f2e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s, visibility 0.5s;
        }

        #loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-content {
            text-align: center;
            padding: 20px;
        }

        .loading-content h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .solar-system-loader {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
        }

        .solar-system-loader .sun {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 25px;
            height: 25px;
            margin: -12.5px 0 0 -12.5px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffd700, #ff8c00);
            box-shadow: 0 0 20px #ffd700, 0 0 40px #ff8c00;
            animation: pulse 2s ease-in-out infinite;
        }

        .solar-system-loader .planet {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            margin: -4px 0 0 -4px;
            border-radius: 50%;
            background: #4a9eff;
            box-shadow: 0 0 8px #4a9eff;
            animation: orbit 2s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(40px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(40px) rotate(-360deg); }
        }

        .loading-bar {
            width: 180px;
            height: 3px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 15px;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        /* Main App */
        #app {
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available;
            position: relative;
            touch-action: none;
        }

        /* Header - Mobile Optimized */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 100;
            box-shadow: 0 2px 10px var(--shadow-dark);
        }

        .header h1 {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .btn-icon:active {
            transform: scale(0.95);
            background: var(--accent-primary);
        }

        .btn-icon.active {
            background: var(--accent-primary);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        /* Canvas Container */
        #canvas-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            touch-action: none;
        }

        /* Bottom Control Bar - Mobile */
        .bottom-control-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            padding: 15px;
            z-index: 90;
            max-height: 25vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .bottom-control-bar.hidden {
            transform: translateY(100%);
        }

        .control-toggle {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background: rgba(26, 31, 46, 0.95);
            border-radius: 15px 15px 0 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            z-index: 91;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .control-toggle:active {
            transform: translateX(-50%) scale(0.95);
        }

        .planet-buttons-mobile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .planet-btn-mobile {
            padding: 12px 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            text-align: center;
            font-weight: 500;
            touch-action: manipulation;
        }

        .planet-btn-mobile:active {
            transform: scale(0.95);
            background: var(--accent-primary);
        }

        .speed-control-mobile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .speed-control-mobile label {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 70px;
        }

        .speed-control-mobile input[type="range"] {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }

        .speed-control-mobile input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            box-shadow: 0 0 8px rgba(99, 102, 241, 0.5);
        }

        .speed-value-mobile {
            color: var(--accent-glow);
            font-weight: 600;
            font-size: 12px;
            min-width: 35px;
        }

        /* Info Panel - Mobile */
        .info-panel-mobile {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 31, 46, 0.98);
            backdrop-filter: blur(10px);
            z-index: 200;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .info-panel-mobile.active {
            transform: translateY(0);
        }

        .panel-header-mobile {
            position: sticky;
            top: 0;
            padding: 20px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(26, 31, 46, 0.98);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .panel-header-mobile h2 {
            font-size: 22px;
            color: var(--text-primary);
        }

        .close-btn-mobile {
            width: 35px;
            height: 35px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 24px;
            line-height: 1;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .close-btn-mobile:active {
            transform: scale(0.95) rotate(90deg);
            background: #ef4444;
        }

        .panel-content-mobile {
            padding: 20px 15px;
        }

        .panel-content-mobile p {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .info-grid-mobile {
            display: grid;
            gap: 12px;
            margin: 15px 0;
        }

        .info-item-mobile {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-primary);
        }

        .info-label-mobile {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }

        .info-value-mobile {
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 600;
            text-align: right;
        }

        /* Chat Interface - Mobile */
        .chat-interface-mobile {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 31, 46, 0.98);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            z-index: 200;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .chat-interface-mobile.active {
            transform: translateY(0);
        }

        .chat-header-mobile {
            padding: 20px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(26, 31, 46, 0.98);
        }

        .chat-header-mobile h3 {
            font-size: 18px;
            color: var(--text-primary);
        }

        .chat-messages-mobile {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-mobile {
            display: flex;
            flex-direction: column;
            gap: 6px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-content-mobile {
            padding: 12px 14px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .message-mobile.user .message-content-mobile {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            align-self: flex-end;
            max-width: 85%;
        }

        .message-mobile.assistant .message-content-mobile {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            max-width: 90%;
            border: 1px solid var(--border-color);
        }

        .message-mobile.assistant .message-content-mobile ul {
            margin: 8px 0 0 18px;
        }

        .message-mobile.assistant .message-content-mobile li {
            margin: 4px 0;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .chat-input-container-mobile {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
            background: rgba(26, 31, 46, 0.98);
        }

        #chatInputMobile {
            flex: 1;
            padding: 12px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
        }

        #chatInputMobile:focus {
            border-color: var(--accent-primary);
        }

        .btn-send-mobile {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            touch-action: manipulation;
        }

        .btn-send-mobile:active {
            transform: scale(0.95);
        }

        /* Toast Notifications */
        .toast-mobile {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(26, 31, 46, 0.98);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px var(--shadow-dark);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 80%;
            text-align: center;
            font-size: 14px;
        }

        .toast-mobile.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Quick Action Button */
        .quick-action-btn {
            position: fixed;
            bottom: 80px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            z-index: 89;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        /* Landscape Warning */
        @media (orientation: landscape) and (max-height: 500px) {
            .landscape-warning {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: rgba(255, 152, 0, 0.95);
                color: white;
                padding: 8px;
                text-align: center;
                font-size: 12px;
                z-index: 9999;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="solar-system-loader">
                <div class="sun"></div>
                <div class="planet"></div>
            </div>
            <h2>Initializing Solar System...</h2>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>üåå Solar System</h1>
            </div>
            <div class="header-right">
                <button id="toggleAudioMobile" class="btn-icon" title="Toggle Audio">
                    <span class="audio-icon">üîä</span>
                </button>
                <button id="toggleChatMobile" class="btn-icon" title="Chat">
                    <span>üí¨</span>
                </button>
                <button id="toggleInfoMobile" class="btn-icon" title="Info">
                    <span>‚ÑπÔ∏è</span>
                </button>
            </div>
        </header>

        <!-- 3D Canvas Container -->
        <div id="canvas-container"></div>

        <!-- Control Toggle Button -->
        <div class="control-toggle" id="controlToggle">‚ò∞</div>

        <!-- Bottom Control Bar -->
        <div class="bottom-control-bar" id="bottomControlBar">
            <div class="planet-buttons-mobile" id="planetButtonsMobile"></div>

            <div class="speed-control-mobile">
                <label>Speed:</label>
                <input type="range" id="speedControlMobile" min="0" max="5" step="0.1" value="1">
                <span class="speed-value-mobile" id="speedValueMobile">1.0x</span>
            </div>
        </div>

        <!-- Quick Action Button -->
        <button class="quick-action-btn" id="resetCameraMobile">üéØ</button>

        <!-- Info Panel -->
        <div id="infoPanelMobile" class="info-panel-mobile">
            <div class="panel-header-mobile">
                <h2 id="infoPanelTitleMobile">Welcome</h2>
                <button class="close-btn-mobile" id="closeInfoMobile">√ó</button>
            </div>
            <div class="panel-content-mobile" id="infoPanelContentMobile">
                <p>Tap on any planet or moon to learn more! Use the chat assistant for questions.</p>
                <div class="info-grid-mobile">
                    <div class="info-item-mobile">
                        <span class="info-label-mobile">Type:</span>
                        <span class="info-value-mobile">Solar System</span>
                    </div>
                    <div class="info-item-mobile">
                        <span class="info-label-mobile">Star:</span>
                        <span class="info-value-mobile">Sun</span>
                    </div>
                    <div class="info-item-mobile">
                        <span class="info-label-mobile">Planets:</span>
                        <span class="info-value-mobile">8</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div id="chatInterfaceMobile" class="chat-interface-mobile">
            <div class="chat-header-mobile">
                <h3>ü§ñ Solar Assistant</h3>
                <button class="close-btn-mobile" id="closeChatMobile">√ó</button>
            </div>
            <div class="chat-messages-mobile" id="chatMessagesMobile">
                <div class="message-mobile assistant">
                    <div class="message-content-mobile">
                        <p>Hello! Ask me anything about space! Try:</p>
                        <ul>
                            <li>"Tell me about Mars"</li>
                            <li>"How many moons does Jupiter have?"</li>
                            <li>"What makes Saturn special?"</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="chat-input-container-mobile">
                <input type="text" id="chatInputMobile" placeholder="Ask about planets..." />
                <button id="sendMessageMobile" class="btn-send-mobile">Send</button>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toastMobile" class="toast-mobile"></div>
    </div>

    <!-- Three.js and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Main Application Script -->
    <script>
        // Interactive 3D Solar System - iPhone Optimized

        // ==================== Global Variables ====================
        let scene, camera, renderer, controls;
        let celestialBodies = {};
        let raycaster, mouse, touchStart;
        let animationId;
        let audioContext, isAudioPlaying = false;
        let orbitSpeed = 1;

        // ==================== Celestial Bodies Data ====================
        const celestialData = {
            sun: {
                name: "Sun",
                type: "Star",
                radius: 15,
                color: 0xFDB813,
                mass: "1.989 √ó 10¬≥‚Å∞ kg",
                diameter: "1,392,700 km",
                temperature: "5,778 K",
                info: "The Sun is the star at the center of the Solar System. It accounts for about 99.86% of the total mass of the Solar System.",
                funFacts: [
                    "Contains 99.86% of solar system mass",
                    "Light takes 8 minutes to reach Earth",
                    "About 4.6 billion years old",
                    "Could fit 1.3 million Earths inside"
                ]
            },
            mercury: {
                name: "Mercury",
                type: "Terrestrial Planet",
                radius: 1.8,
                color: 0x8C7853,
                distance: 30,
                orbitSpeed: 0.04,
                rotationSpeed: 0.001,
                mass: "3.285 √ó 10¬≤¬≥ kg",
                diameter: "4,879 km",
                dayLength: "58.6 Earth days",
                yearLength: "88 Earth days",
                moons: 0,
                info: "Mercury is the smallest and innermost planet. It has extreme temperature variations, from 430¬∞C during day to -180¬∞C at night.",
                funFacts: [
                    "No atmosphere to retain heat",
                    "Fastest orbiting planet",
                    "Named after Roman messenger god"
                ]
            },
            venus: {
                name: "Venus",
                type: "Terrestrial Planet",
                radius: 3,
                color: 0xFFC649,
                distance: 45,
                orbitSpeed: 0.015,
                rotationSpeed: -0.0005,
                mass: "4.867 √ó 10¬≤‚Å¥ kg",
                diameter: "12,104 km",
                dayLength: "243 Earth days",
                yearLength: "225 Earth days",
                moons: 0,
                info: "Venus is Earth's closest neighbor. It has a thick, toxic atmosphere that traps heat in a runaway greenhouse effect.",
                funFacts: [
                    "Hottest planet at 465¬∞C",
                    "Rotates backwards",
                    "Day longer than its year"
                ]
            },
            earth: {
                name: "Earth",
                type: "Terrestrial Planet",
                radius: 3.5,
                color: 0x2233FF,
                distance: 65,
                orbitSpeed: 0.01,
                rotationSpeed: 0.02,
                mass: "5.972 √ó 10¬≤‚Å¥ kg",
                diameter: "12,742 km",
                dayLength: "24 hours",
                yearLength: "365.25 days",
                moons: 1,
                info: "Earth is the only known planet with life. About 71% of its surface is covered with water.",
                funFacts: [
                    "Only known planet with life",
                    "70% covered by water",
                    "Has one natural satellite - Moon"
                ],
                moonData: [{
                    name: "Moon",
                    radius: 0.9,
                    distance: 7,
                    orbitSpeed: 0.03,
                    color: 0xAAAAA,
                    mass: "7.342 √ó 10¬≤¬≤ kg",
                    diameter: "3,474 km",
                    info: "Earth's only natural satellite, the fifth largest moon in the Solar System."
                }]
            },
            mars: {
                name: "Mars",
                type: "Terrestrial Planet",
                radius: 2.5,
                color: 0xCD5C5C,
                distance: 85,
                orbitSpeed: 0.008,
                rotationSpeed: 0.018,
                mass: "6.39 √ó 10¬≤¬≥ kg",
                diameter: "6,779 km",
                dayLength: "24.6 hours",
                yearLength: "687 Earth days",
                moons: 2,
                info: "Mars is often called the 'Red Planet' due to iron oxide on its surface. It has the largest volcano in the solar system.",
                funFacts: [
                    "Home to Olympus Mons - tallest volcano",
                    "Has polar ice caps like Earth",
                    "Day is 24.6 hours"
                ],
                moonData: [
                    {
                        name: "Phobos",
                        radius: 0.4,
                        distance: 4.5,
                        orbitSpeed: 0.05,
                        color: 0x998877,
                        diameter: "22.4 km",
                        info: "Phobos orbits closer to its planet than any other moon."
                    },
                    {
                        name: "Deimos",
                        radius: 0.3,
                        distance: 6,
                        orbitSpeed: 0.03,
                        color: 0xAA9988,
                        diameter: "12.4 km",
                        info: "Deimos takes 30 hours to orbit Mars."
                    }
                ]
            },
            jupiter: {
                name: "Jupiter",
                type: "Gas Giant",
                radius: 9,
                color: 0xDAA520,
                distance: 120,
                orbitSpeed: 0.002,
                rotationSpeed: 0.04,
                mass: "1.898 √ó 10¬≤‚Å∑ kg",
                diameter: "139,820 km",
                dayLength: "9.9 hours",
                yearLength: "11.9 Earth years",
                moons: 79,
                info: "Jupiter is the largest planet. The Great Red Spot is a giant storm that's been raging for hundreds of years.",
                funFacts: [
                    "Largest planet in solar system",
                    "Has 79 known moons",
                    "Great Red Spot is 300 years old",
                    "Could fit 1,300 Earths inside"
                ],
                moonData: [
                    {
                        name: "Io",
                        radius: 0.7,
                        distance: 13,
                        orbitSpeed: 0.06,
                        color: 0xFFFF00,
                        diameter: "3,643 km",
                        info: "Most volcanically active body with 400+ volcanoes."
                    },
                    {
                        name: "Europa",
                        radius: 0.6,
                        distance: 16,
                        orbitSpeed: 0.045,
                        color: 0xBBCCDD,
                        diameter: "3,122 km",
                        info: "Has ice surface with subsurface ocean that could harbor life."
                    },
                    {
                        name: "Ganymede",
                        radius: 0.8,
                        distance: 19,
                        orbitSpeed: 0.035,
                        color: 0x998866,
                        diameter: "5,268 km",
                        info: "Largest moon in solar system, bigger than Mercury."
                    }
                ]
            },
            saturn: {
                name: "Saturn",
                type: "Gas Giant",
                radius: 7.5,
                color: 0xFAD5A5,
                distance: 160,
                orbitSpeed: 0.0009,
                rotationSpeed: 0.038,
                mass: "5.683 √ó 10¬≤‚Å∂ kg",
                diameter: "116,460 km",
                dayLength: "10.7 hours",
                yearLength: "29.4 Earth years",
                moons: 82,
                rings: true,
                info: "Saturn is best known for its prominent ring system made of ice and rock particles. It has 82 known moons.",
                funFacts: [
                    "Famous for spectacular rings",
                    "Has 82 confirmed moons",
                    "Least dense - could float in water"
                ],
                moonData: [
                    {
                        name: "Titan",
                        radius: 0.8,
                        distance: 14,
                        orbitSpeed: 0.04,
                        color: 0xFF8C00,
                        diameter: "5,150 km",
                        info: "Only moon with dense atmosphere. Has liquid methane lakes."
                    }
                ]
            },
            uranus: {
                name: "Uranus",
                type: "Ice Giant",
                radius: 5,
                color: 0x4FD0E7,
                distance: 195,
                orbitSpeed: 0.0004,
                rotationSpeed: 0.03,
                mass: "8.681 √ó 10¬≤‚Åµ kg",
                diameter: "50,724 km",
                dayLength: "17.2 hours",
                yearLength: "84 Earth years",
                moons: 27,
                info: "Uranus uniquely rotates on its side, likely due to an ancient collision.",
                funFacts: [
                    "Rotates on its side at 98¬∞",
                    "Coldest atmosphere at -224¬∞C",
                    "Has 13 known rings"
                ]
            },
            neptune: {
                name: "Neptune",
                type: "Ice Giant",
                radius: 4.8,
                color: 0x4169E1,
                distance: 230,
                orbitSpeed: 0.0001,
                rotationSpeed: 0.032,
                mass: "1.024 √ó 10¬≤‚Å∂ kg",
                diameter: "49,244 km",
                dayLength: "16.1 hours",
                yearLength: "164.8 Earth years",
                moons: 14,
                info: "Neptune has the strongest winds in the Solar System, reaching speeds of 2,100 km/h.",
                funFacts: [
                    "Farthest planet from Sun",
                    "Strongest winds at 2,100 km/h",
                    "Discovered by math prediction"
                ],
                moonData: [
                    {
                        name: "Triton",
                        radius: 0.6,
                        distance: 10,
                        orbitSpeed: 0.045,
                        color: 0xEEDDCC,
                        diameter: "2,707 km",
                        info: "Only large moon with retrograde orbit."
                    }
                ]
            }
        };

        // ==================== Initialization ====================
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            // Camera setup
            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                0.1,
                10000
            );
            camera.position.set(0, 80, 150);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Optimize for mobile
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Controls - Touch optimized
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 25;
            controls.maxDistance = 400;
            controls.touches = {
                ONE: THREE.TOUCH.ROTATE,
                TWO: THREE.TOUCH.DOLLY_PAN
            };

            // Raycaster for touch interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Add starfield
            createStarfield();

            // Create solar system
            createSolarSystem();

            // Setup UI
            setupUI();

            // Setup audio
            setupAudio();

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('touchend', onTouchEnd);

            // Start animation
            animate();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
                showToast('Tap audio button to enable sounds üéµ');
            }, 2000);
        }

        // ==================== Starfield Creation ====================
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xFFFFFF,
                size: 0.6,
                transparent: true,
                opacity: 0.8
            });

            const starVertices = [];
            for (let i = 0; i < 5000; i++) { // Reduced for mobile performance
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }

            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // ==================== Solar System Creation ====================
        function createSolarSystem() {
            // Create Sun
            const sunGeometry = new THREE.SphereGeometry(celestialData.sun.radius, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: celestialData.sun.color,
                emissive: celestialData.sun.color,
                emissiveIntensity: 1
            });
            const sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.userData = celestialData.sun;
            scene.add(sun);
            celestialBodies.sun = sun;

            // Add sun glow
            const glowGeometry = new THREE.SphereGeometry(celestialData.sun.radius * 1.2, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xFFA500,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            sun.add(glow);

            // Add sun light
            const sunLight = new THREE.PointLight(0xFFFFFF, 2, 1000);
            sunLight.position.set(0, 0, 0);
            scene.add(sunLight);

            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);

            // Create planets
            Object.keys(celestialData).forEach(key => {
                if (key !== 'sun') {
                    createPlanet(key, celestialData[key]);
                }
            });
        }

        function createPlanet(key, data) {
            // Create orbit path
            const orbitGeometry = new THREE.RingGeometry(data.distance - 0.2, data.distance + 0.2, 64);
            const orbitMaterial = new THREE.MeshBasicMaterial({
                color: 0x444444,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.3
            });
            const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
            orbit.rotation.x = Math.PI / 2;
            scene.add(orbit);

            // Create planet
            const planetGeometry = new THREE.SphereGeometry(data.radius, 24, 24);
            const planetMaterial = new THREE.MeshStandardMaterial({
                color: data.color,
                metalness: 0.4,
                roughness: 0.7
            });
            const planet = new THREE.Mesh(planetGeometry, planetMaterial);
            planet.userData = data;
            planet.userData.key = key;

            // Create planet group for orbit
            const planetGroup = new THREE.Group();
            planetGroup.add(planet);
            planet.position.x = data.distance;
            scene.add(planetGroup);

            celestialBodies[key] = {
                planet: planet,
                group: planetGroup,
                angle: Math.random() * Math.PI * 2,
                moons: []
            };

            // Create rings for Saturn
            if (data.rings) {
                const ringGeometry = new THREE.RingGeometry(data.radius * 1.2, data.radius * 2, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0xCCAAAA,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.6
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                planet.add(ring);
            }

            // Create moons
            if (data.moonData) {
                data.moonData.forEach((moonData, index) => {
                    createMoon(planet, moonData, key, index);
                });
            }
        }

        function createMoon(planet, moonData, planetKey, moonIndex) {
            const moonGeometry = new THREE.SphereGeometry(moonData.radius, 12, 12);
            const moonMaterial = new THREE.MeshStandardMaterial({
                color: moonData.color,
                metalness: 0.3,
                roughness: 0.8
            });
            const moon = new THREE.Mesh(moonGeometry, moonMaterial);
            moon.userData = moonData;
            moon.userData.key = `${planetKey}_moon_${moonIndex}`;
            moon.userData.type = 'Moon';

            const moonGroup = new THREE.Group();
            moonGroup.add(moon);
            moon.position.x = moonData.distance;
            planet.add(moonGroup);

            celestialBodies[planetKey].moons.push({
                moon: moon,
                group: moonGroup,
                angle: Math.random() * Math.PI * 2,
                data: moonData
            });
        }

        // ==================== Animation ====================
        function animate() {
            animationId = requestAnimationFrame(animate);

            // Update controls
            controls.update();

            // Rotate and orbit planets
            Object.keys(celestialBodies).forEach(key => {
                if (key !== 'sun') {
                    const body = celestialBodies[key];

                    // Orbit around sun
                    body.angle += celestialData[key].orbitSpeed * 0.001 * orbitSpeed;
                    body.group.rotation.y = body.angle;

                    // Rotate planet
                    body.planet.rotation.y += celestialData[key].rotationSpeed * orbitSpeed;

                    // Orbit moons
                    body.moons.forEach(moonObj => {
                        moonObj.angle += moonObj.data.orbitSpeed * 0.01 * orbitSpeed;
                        moonObj.group.rotation.y = moonObj.angle;
                    });
                } else {
                    // Rotate sun
                    celestialBodies.sun.rotation.y += 0.001 * orbitSpeed;
                }
            });

            renderer.render(scene, camera);
        }

        // ==================== Audio System ====================
        function setupAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createAmbientSound();
            } catch (e) {
                console.log('Audio context creation failed');
            }
        }

        function createAmbientSound() {
            if (!audioContext) return;

            const oscillators = [];
            const gainNodes = [];

            // Base frequencies for ambient electronic music
            const frequencies = [55, 82.41, 110, 164.81, 220]; // A notes

            frequencies.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillators.push(oscillator);
                gainNodes.push(gainNode);
            });

            window.audioOscillators = oscillators;
            window.audioGainNodes = gainNodes;
        }

        function toggleAudio() {
            if (!audioContext) {
                setupAudio();
            }

            // Resume audio context on iOS
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            if (isAudioPlaying) {
                // Fade out
                window.audioGainNodes.forEach(gainNode => {
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1);
                });
                isAudioPlaying = false;
                document.querySelector('.audio-icon').textContent = 'üîá';
                showToast('Audio paused');
            } else {
                // Start oscillators if not started
                if (!window.audioStarted) {
                    window.audioOscillators.forEach(osc => osc.start());
                    window.audioStarted = true;
                }

                // Fade in with different volumes
                window.audioGainNodes.forEach((gainNode, index) => {
                    const volume = 0.04 / (index + 1);
                    gainNode.gain.exponentialRampToValueAtTime(volume, audioContext.currentTime + 2);
                });

                isAudioPlaying = true;
                document.querySelector('.audio-icon').textContent = 'üîä';
                showToast('Calm ambient sounds playing üéµ');
            }
        }

        // ==================== UI Setup ====================
        function setupUI() {
            // Planet buttons
            const planetButtons = document.getElementById('planetButtonsMobile');
            Object.keys(celestialData).forEach(key => {
                const button = document.createElement('button');
                button.className = 'planet-btn-mobile';
                button.textContent = celestialData[key].name;
                button.onclick = () => focusOnPlanet(key);
                planetButtons.appendChild(button);
            });

            // Speed control
            document.getElementById('speedControlMobile').addEventListener('input', (e) => {
                orbitSpeed = parseFloat(e.target.value);
                document.getElementById('speedValueMobile').textContent = orbitSpeed.toFixed(1) + 'x';
            });

            // Control toggle
            document.getElementById('controlToggle').addEventListener('click', () => {
                const bar = document.getElementById('bottomControlBar');
                bar.classList.toggle('hidden');
            });

            // Reset camera
            document.getElementById('resetCameraMobile').addEventListener('click', () => {
                camera.position.set(0, 80, 150);
                controls.target.set(0, 0, 0);
                showToast('Camera reset');
            });

            // Toggle audio
            document.getElementById('toggleAudioMobile').addEventListener('click', toggleAudio);

            // Toggle chat
            document.getElementById('toggleChatMobile').addEventListener('click', () => {
                const chat = document.getElementById('chatInterfaceMobile');
                const info = document.getElementById('infoPanelMobile');
                info.classList.remove('active');
                chat.classList.toggle('active');
                document.getElementById('toggleChatMobile').classList.toggle('active');
            });

            // Toggle info
            document.getElementById('toggleInfoMobile').addEventListener('click', () => {
                const info = document.getElementById('infoPanelMobile');
                const chat = document.getElementById('chatInterfaceMobile');
                chat.classList.remove('active');
                info.classList.toggle('active');
                document.getElementById('toggleInfoMobile').classList.toggle('active');
            });

            // Close buttons
            document.getElementById('closeInfoMobile').addEventListener('click', () => {
                document.getElementById('infoPanelMobile').classList.remove('active');
                document.getElementById('toggleInfoMobile').classList.remove('active');
            });

            document.getElementById('closeChatMobile').addEventListener('click', () => {
                document.getElementById('chatInterfaceMobile').classList.remove('active');
                document.getElementById('toggleChatMobile').classList.remove('active');
            });

            // Chat functionality
            document.getElementById('sendMessageMobile').addEventListener('click', sendChatMessage);
            document.getElementById('chatInputMobile').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
        }

        // ==================== Interaction ====================
        function onTouchEnd(event) {
            if (event.touches.length === 0 && event.changedTouches.length > 0) {
                const touch = event.changedTouches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);

                const allObjects = [];
                Object.keys(celestialBodies).forEach(key => {
                    if (key === 'sun') {
                        allObjects.push(celestialBodies[key]);
                    } else {
                        allObjects.push(celestialBodies[key].planet);
                        celestialBodies[key].moons.forEach(moonObj => {
                            allObjects.push(moonObj.moon);
                        });
                    }
                });

                const intersects = raycaster.intersectObjects(allObjects);

                if (intersects.length > 0) {
                    const object = intersects[0].object;
                    showInfoPanel(object.userData);
                }
            }
        }

        function focusOnPlanet(key) {
            if (key === 'sun') {
                camera.position.set(0, 40, 80);
                controls.target.set(0, 0, 0);
                showInfoPanel(celestialData.sun);
            } else {
                const body = celestialBodies[key];
                const planet = body.planet;
                const worldPos = new THREE.Vector3();
                planet.getWorldPosition(worldPos);

                const distance = celestialData[key].radius * 5;
                camera.position.set(worldPos.x + distance, worldPos.y + distance/2, worldPos.z + distance);
                controls.target.copy(worldPos);
                showInfoPanel(celestialData[key]);
            }
            showToast(`Viewing ${celestialData[key].name}`);
        }

        function showInfoPanel(data) {
            const panel = document.getElementById('infoPanelMobile');
            const title = document.getElementById('infoPanelTitleMobile');
            const content = document.getElementById('infoPanelContentMobile');

            title.textContent = data.name;

            let html = `<p>${data.info}</p>`;

            html += '<div class="info-grid-mobile">';
            if (data.type) html += `<div class="info-item-mobile"><span class="info-label-mobile">Type:</span><span class="info-value-mobile">${data.type}</span></div>`;
            if (data.diameter) html += `<div class="info-item-mobile"><span class="info-label-mobile">Diameter:</span><span class="info-value-mobile">${data.diameter}</span></div>`;
            if (data.mass) html += `<div class="info-item-mobile"><span class="info-label-mobile">Mass:</span><span class="info-value-mobile">${data.mass}</span></div>`;
            if (data.dayLength) html += `<div class="info-item-mobile"><span class="info-label-mobile">Day:</span><span class="info-value-mobile">${data.dayLength}</span></div>`;
            if (data.yearLength) html += `<div class="info-item-mobile"><span class="info-label-mobile">Year:</span><span class="info-value-mobile">${data.yearLength}</span></div>`;
            if (data.moons !== undefined) html += `<div class="info-item-mobile"><span class="info-label-mobile">Moons:</span><span class="info-value-mobile">${data.moons}</span></div>`;
            if (data.temperature) html += `<div class="info-item-mobile"><span class="info-label-mobile">Temp:</span><span class="info-value-mobile">${data.temperature}</span></div>`;
            html += '</div>';

            if (data.funFacts) {
                html += '<h4 style="margin-top: 20px; color: var(--accent-glow); font-size: 16px;">Fun Facts:</h4><ul style="margin-left: 20px; margin-top: 10px;">';
                data.funFacts.forEach(fact => {
                    html += `<li style="margin: 8px 0; color: var(--text-secondary); line-height: 1.5;">${fact}</li>`;
                });
                html += '</ul>';
            }

            content.innerHTML = html;
            panel.classList.add('active');
            document.getElementById('toggleInfoMobile').classList.add('active');
        }

        // ==================== Chat Interface ====================
        function sendChatMessage() {
            const input = document.getElementById('chatInputMobile');
            const message = input.value.trim();

            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            setTimeout(() => {
                const response = generateChatResponse(message);
                addChatMessage(response, 'assistant');
            }, 500);
        }

        function addChatMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessagesMobile');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-mobile ${sender}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content-mobile';
            contentDiv.innerHTML = text;

            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateChatResponse(message) {
            const lowerMessage = message.toLowerCase();

            // Check for planet names
            for (const key in celestialData) {
                const data = celestialData[key];
                if (lowerMessage.includes(data.name.toLowerCase())) {
                    focusOnPlanet(key);

                    let response = `<strong>${data.name}</strong> ${data.info}<br><br>`;

                    if (data.funFacts && data.funFacts.length > 0) {
                        response += '<strong>Interesting facts:</strong><ul>';
                        data.funFacts.slice(0, 2).forEach(fact => {
                            response += `<li>${fact}</li>`;
                        });
                        response += '</ul>';
                    }

                    return response;
                }
            }

            // Pattern matching
            if (lowerMessage.includes('moon') && lowerMessage.includes('how many')) {
                if (lowerMessage.includes('jupiter')) {
                    return 'Jupiter has <strong>79 known moons</strong>! The four largest are Io, Europa, Ganymede, and Callisto.';
                } else if (lowerMessage.includes('saturn')) {
                    return 'Saturn has <strong>82 confirmed moons</strong>, with Titan being the largest!';
                }
                return 'Jupiter has 79, Saturn has 82, Mars has 2, and Earth has 1 moon!';
            }

            if (lowerMessage.includes('biggest') || lowerMessage.includes('largest')) {
                focusOnPlanet('jupiter');
                return '<strong>Jupiter</strong> is the largest planet! It\'s so big that <strong>1,300 Earths</strong> could fit inside it.';
            }

            if (lowerMessage.includes('hottest')) {
                focusOnPlanet('venus');
                return '<strong>Venus</strong> is the hottest planet at <strong>465¬∞C</strong> due to its thick atmosphere!';
            }

            if (lowerMessage.includes('ring')) {
                focusOnPlanet('saturn');
                return '<strong>Saturn</strong> is famous for its spectacular ring system made of ice and rock!';
            }

            if (lowerMessage.includes('life')) {
                focusOnPlanet('earth');
                return '<strong>Earth</strong> is the only known planet with life! Scientists are exploring Europa and Enceladus for potential life.';
            }

            const responses = [
                'Try asking about specific planets like "Tell me about Mars" or "How hot is Venus?"',
                'Tap on any planet to learn more, or ask questions like "Which planet is biggest?"',
                'I can help with planets and moons! Try "How many moons does Jupiter have?"'
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        // ==================== Utility Functions ====================
        function showToast(message) {
            const toast = document.getElementById('toastMobile');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ==================== Start Application ====================
        window.addEventListener('DOMContentLoaded', init);

        // Prevent default touch behaviors
        document.addEventListener('touchmove', function(e) {
            if (e.target.tagName !== 'INPUT') {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
